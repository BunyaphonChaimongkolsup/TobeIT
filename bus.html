<!DOCTYPE html>
<html>
<head>
    <title>ตำแหน่งการขนส่งสาธารณะเพื่อคนพิการและผู้สูงอายุ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        #map {
            height: 800px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>แผนที่การขนส่งสาธารณะทางรถรางเพื่อคนพิการและผู้สูงอายุ</h1>
    <button onclick="locateUser()">ค้นหาตำแหน่งของฉัน</button>
    <button onclick="setCustomLocation()">เลือกตำแหน่งเอง</button>
    <div id="map"></div>
    <script>
        // สร้างแผนที่พื้นฐาน
        const map = L.map('map').setView([13.736717, 100.523186], 12); // เริ่มที่กรุงเทพฯ
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data © <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18,
        }).addTo(map);

        let userMarker; // เก็บ Marker ตำแหน่งผู้ใช้

        // ฟังก์ชันดึงชื่อสถานที่จากตำแหน่ง (Reverse Geocoding)
        async function getPlaceName(lat, lng) {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
            const data = await response.json();
            return data.display_name || "ไม่สามารถระบุสถานที่ได้";
        }

        // ฟังก์ชันปักหมุดพร้อมดึงชื่อสถานที่และเพิ่มชื่อสถานี
        async function addFixedMarker(lat, lng, stationName) {
            const placeName = await getPlaceName(lat, lng); // ดึงชื่อสถานที่
            L.marker([lat, lng]).addTo(map)
                .bindPopup(`${stationName}: ${placeName}`) // เพิ่มชื่อสถานีก่อนข้อความสถานที่
                .openPopup();
        }

        // เรียกฟังก์ชันเพื่อปักหมุดที่ตำแหน่งที่กำหนด
        addFixedMarker(8.099574651, 98.90569388, "สถานีขนส่งผู้โดยสารกระบี่");
        addFixedMarker(14.02114145, 99.53433405, "สถานีขนส่งผู้โดยสารกาญจนบุรี");
        addFixedMarker(16.42979741, 103.5018569, "สถานีขนส่งผู้โดยสารกาฬสินธุ์ (บ.แสงประทีปเดินรถ จก.)");
        addFixedMarker(16.47473019, 99.51025833, "สถานีขนส่งผู้โดยสารกำแพงเพชร (อบจ.กำแพงเพชร)");
        addFixedMarker(16.54291927, 102.1006319, "สถานีขนส่งผู้โดยสารขอนแก่น (ชุมแพ)");
        addFixedMarker(16.05693265, 102.7269882, "สถานีขนส่งผู้โดยสารขอนแก่น (บ้านไผ่)");
        addFixedMarker(16.64834358, 102.3807859, "สถานีขนส่งผู้โดยสารขอนแก่น (ภูเวียง)");
        addFixedMarker(15.81411819, 102.6057165, "สถานีขนส่งผู้โดยสารขอนแก่น (เมืองพล)");
        addFixedMarker(16.39025299, 102.8047064, "สถานีขนส่งผู้โดยสารขอนแก่น (แห่งที่ 3)");
        addFixedMarker(12.61189872, 102.1060465, "สถานีขนส่งผู้โดยสารจันทบุรี");
        addFixedMarker(13.68264565, 101.0666462, "สถานีขนส่งผู้โดยสารฉะเชิงเทรา");
        addFixedMarker(13.73434998, 101.3332343, "สถานีขนส่งผู้โดยสารฉะเชิงเทรา (พนมสารคาม)");
        addFixedMarker(13.40097604, 100.9971465, "สถานีขนส่งผู้โดยสารชลบุรี");
        addFixedMarker(15.19750782, 100.1246186, "สถานีขนส่งผู้โดยสารชัยนาท (ทม.ชัยนาท)");
        addFixedMarker(16.36410436, 102.1285663, "สถานีขนส่งผู้โดยสารชัยภูมิ (ภูเขียว) (บขส.)");
        addFixedMarker(15.81289894, 102.0354456, "สถานีขนส่งผู้โดยสารชัยภูมิ (แห่งที่ 1)(ทม.ชัยภูมิ)");
        addFixedMarker(15.79002673, 102.0429602, "สถานีขนส่งผู้โดยสารชัยภูมิ (แห่งที่ 2)(ทม.ชัยภูมิ)");
        addFixedMarker(10.48731341, 99.12055403, "สถานีขนส่งผู้โดยสารชุมพร (ปฐมพร) (อบจ.ชุมพร)");
        addFixedMarker(20.22666782, 100.4030283, "สถานีขนส่งผู้โดยสารเชียงราย (เชียงของ)");
        addFixedMarker(19.68851131, 100.190551, "สถานีขนส่งผู้โดยสารเชียงราย (เทิง)");
        addFixedMarker(20.40453447, 99.88224986, "สถานีขนส่งผู้โดยสารเชียงราย (แม่สาย)");
        addFixedMarker(19.904561, 99.83423596, "สถานีขนส่งผู้โดยสารเชียงราย (แห่งที่ 1)");
        addFixedMarker(19.85814412, 99.8209931, "สถานีขนส่งผู้โดยสารเชียงราย (แห่งที่ 2)");
        addFixedMarker(18.76685549, 99.00589807, "สถานีขนส่งผู้โดยสารเชียงใหม่ (แห่งที่ 1) (ทน.เชียงใหม่)");
        addFixedMarker(18.74556618, 98.96216924, "สถานีขนส่งผู้โดยสารเชียงใหม่ (แห่งที่ 2) (ทน.เชียงใหม่)");
        addFixedMarker(18.79986328, 99.01770021, "สถานีขนส่งผู้โดยสารเชียงใหม่ (แห่งที่ 3) (ทน.เชียงใหม่)");
        addFixedMarker(7.567003536, 99.62788713, "สถานีขนส่งผู้โดยสารตรัง");
        addFixedMarker(12.25403896, 102.5138951, "สถานีขนส่งผู้โดยสารตราด (ทม.ตราด)");
        addFixedMarker(16.88341197, 99.12824849, "สถานีขนส่งผู้โดยสารตาก (อบจ.ตาก)");
        addFixedMarker(16.70470976, 98.54618843, "สถานีขนส่งผู้โดยสารตาก (แม่สอด-ทต.ท่าสายลวด)");
        addFixedMarker(14.22300589, 101.2244897, "สถานีขนส่งผู้โดยสารนครนายก (สขจ.นครนายก)");
        addFixedMarker(13.81538012, 100.0640274, "สถานีขนส่งผู้โดยสารนครปฐม");
        addFixedMarker(17.39796554, 104.7767009, "สถานีขนส่งผู้โดยสารนครพนม");
        addFixedMarker(17.96491266, 104.2093919, "สถานีขนส่งผู้โดยสารนครพนม (บ้านแพง-ทต.บ้านแพง)");
        addFixedMarker(14.74169469, 102.154003, "สถานีขนส่งผู้โดยสารนครราชสีมา (โชคชัย-อบจ.นครราชสีมา)");
        addFixedMarker(14.70450678, 101.4143266, "สถานีขนส่งผู้โดยสารนครราชสีมา (พิมาย-บ.ประกิจยนต์ จก.)");
        addFixedMarker(14.97813103, 102.0924374, "สถานีขนส่งผู้โดยสารนครราชสีมา (แห่งที่ 1)(ทศ.นครราชสีมา)");
        addFixedMarker(14.97804996, 102.1044062, "สถานีขนส่งผู้โดยสารนครราชสีมา (แห่งที่ 2)(บ.ไทยสงวนบริการ จก.)");
        addFixedMarker(8.435953299, 99.95274571, "สถานีขนส่งผู้โดยสารนครศรีธรรมราช");
        addFixedMarker(8.1548843, 99.67110533, "สถานีขนส่งผู้โดยสารนครศรีธรรมราช (ทุ่งสง-ทต.ชะมาย)");
        addFixedMarker(15.70175326, 100.1185304, "สถานีขนส่งผู้โดยสารนครสวรรค์ (เทศบาลนครสวรรค์)");
        addFixedMarker(15.26199242, 100.3505632, "สถานีขนส่งผู้โดยสารนครสวรรค์ (ตาคลี-ทม.ตาคลี)");
        addFixedMarker(15.74889281, 99.78489524, "สถานีขนส่งผู้โดยสารนครสวรรค์ (ลาดยาว-บ.เมืองใหม่อุดมทรัพย์ จก.)");
        addFixedMarker(15.74890606, 99.78489953, "สถานีขนส่งผู้โดยสารนครสวรรค์ (ลาดยาว-อบจ.นครสวรรค์)");
        addFixedMarker(15.86976617, 100.6072375, "สถานีขนส่งผู้โดยสารนครสวรรค์ (หนองบัว)");
        addFixedMarker(6.410915989, 101.8261305, "สถานีขนส่งผู้โดยสารนราธิวาส (นราธิวาส)");
        addFixedMarker(6.021992004, 101.9500099, "สถานีขนส่งผู้โดยสารนราธิวาส (สุไหงโก-ลก)");
        addFixedMarker(19.11556929, 100.8100714, "สถานีขนส่งผู้โดยสารน่าน");
        addFixedMarker(18.35684059, 103.6505281, "สถานีขนส่งผู้โดยสารบึงกาฬ (อบจ.บึงกาฬ)");
        addFixedMarker(14.63223111, 102.7806923, "สถานีขนส่งผู้โดยสารบุรีรัมย์ (นางรอง)");
        addFixedMarker(14.61207421, 103.0273297, "สถานีขนส่งผู้โดยสารบุรีรัมย์ (ประโคนชัย)");
        addFixedMarker(14.05865596, 101.3729331, "สถานีขนส่งผู้โดยสารปราจีนบุรี (อบจ.ปราจีนบุรี)");
        addFixedMarker(13.9864513, 101.7602896, "สถานีขนส่งผู้โดยสารปราจีนบุรี (กบินทร์บุรี-บ.จิตต์พัฒนาพาณิชย์ จก.)");
        addFixedMarker(6.8623763, 101.269793, "สถานีขนส่งผู้โดยสารปัตตานี (อบจ.ปัตตานี)");
        addFixedMarker(14.3267181, 100.4044285, "สถานีขนส่งผู้โดยสารพระนครศรีอยุธยา (เสนา)");
        addFixedMarker(19.17254302, 99.89827095, "สถานีขนส่งผู้โดยสารพะเยา");
        addFixedMarker(8.459367746, 98.52431591, "สถานีขนส่งผู้โดยสารพังงา");
        addFixedMarker(7.632463103, 100.047219, "สถานีขนส่งผู้โดยสารพัทลุง (เฉลิมพระเกียรติฯ)");
        addFixedMarker(16.52761432, 100.1451833, "สถานีขนส่งผู้โดยสารพิจิตร (วชิรบาร1-บ.โสภณทาวเวอร์เฮ้าส์ จก.)");
        addFixedMarker(16.49541364, 100.4776058, "สถานีขนส่งผู้โดยสารพิจิตร (สากเหล็ก-อบจ.พิจิตร)");
        addFixedMarker(16.81891688, 100.2790712, "สถานีขนส่งผู้โดยสารพิษณุโลก (แห่งที่ 1)");
        addFixedMarker(16.81292654, 100.3301418, "สถานีขนส่งผู้โดยสารพิษณุโลก (แห่งที่ 2)");
        addFixedMarker(16.40916288, 101.1622899, "สถานีขนส่งผู้โดยสารเพชรบูรณ์ (ทม.เพชรบูรณ์)");
        addFixedMarker(16.75512106, 101.2076506, "สถานีขนส่งผู้โดยสารเพชรบูรณ์ (หล่มสัก)");
        addFixedMarker(18.14866291, 100.1517031, "สถานีขนส่งผู้โดยสารแพร่");
        addFixedMarker(7.88439766, 98.39573024, "สถานีขนส่งผู้โดยสารภูเก็ต (แห่งที่ 1)");
        addFixedMarker(7.918048671, 98.39495227, "สถานีขนส่งผู้โดยสารภูเก็ต (แห่งที่ 2)");
        addFixedMarker(16.15777356, 103.3099415, "สถานีขนส่งผู้โดยสารมหาสารคาม (ทม.มหาสารคาม)");
        addFixedMarker(16.03781818, 103.1265915, "สถานีขนส่งผู้โดยสารมหาสารคาม (บรบือ-ทศ.บรบือ)");
        addFixedMarker(16.18093436, 103.3013497, "สถานีขนส่งผู้โดยสารมหาสารคาม (พยัฆภูมิพิสัย-อบจ.มหาสารคาม)");
        addFixedMarker(13.7345187, 101.3332132, "สถานีขนส่งผู้โดยสารมหาสารคาม (พนมสารคาม-อบจ.มหาสารคาม)");
        addFixedMarker(16.54616081, 104.7132255, "สถานีขนส่งผู้โดยสารมุกดาหาร (บ.สหทรัพย์สินเดินรถ จก.)");
        addFixedMarker(19.29148664, 97.95966983, "สถานีขนส่งผู้โดยสารแม่ฮ่องสอน (ทม.แม่ฮ่องสอน)");
        addFixedMarker(15.80966921, 104.1567055, "สถานีขนส่งผู้โดยสารยโสธร");
        addFixedMarker(6.559192793, 101.2678799, "สถานีขนส่งผู้โดยสารยะลา (ทน.ยะลา)");
        addFixedMarker(16.05352913, 103.6398738, "สถานีขนส่งผู้โดยสารร้อยเอ็ด");
        addFixedMarker(16.29607495, 103.9779245, "สถานีขนส่งผู้โดยสารร้อยเอ็ด (โพนทอง)");
        addFixedMarker(9.968044931, 98.63914341, "สถานีขนส่งผู้โดยสารระนอง");
        addFixedMarker(12.68339375, 101.2736796, "สถานีขนส่งผู้โดยสารระยอง (แห่งที่ 1) (ทน.ระยอง)");
        addFixedMarker(12.70064372, 101.2157135, "สถานีขนส่งผู้โดยสารระยอง (แห่งที่ 2) (อบจ.ระยอง)");
        addFixedMarker(13.53109714, 99.80693601, "สถานีขนส่งผู้โดยสารราชบุรี (แห่งที่ 1) (ทม.ราชบุรี)");
        addFixedMarker(13.52606023, 99.77885194, "สถานีขนส่งผู้โดยสารราชบุรี (แห่งที่ 2) (อบจ.ราชบุรี)");
        addFixedMarker(15.2152889, 101.1271018, "สถานีขนส่งผู้โดยสารลพบุรี (ชัยบาดาล-อบจ.ลพบุรี)");
        addFixedMarker(14.79874138, 100.6331422, "สถานีขนส่งผู้โดยสารลพบุรี (ทม.ลพบุรี)");
        addFixedMarker(15.06166215, 100.7218252, "สถานีขนส่งผู้โดยสารลพบุรี (โคกสำโรง-อบจ.ลพบุรี)");
        addFixedMarker(15.21531303, 101.1270875, "สถานีขนส่งผู้โดยสารลพบุรี (ลำนารายณ์)");
        addFixedMarker(18.27742291, 99.48328491, "สถานีขนส่งผู้โดยสารลำปาง (ทน.ลำปาง)");
        addFixedMarker(18.56953403, 99.00720524, "สถานีขนส่งผู้โดยสารลำพูน (นายวิจิตร ภู่เจริญ)");
        addFixedMarker(15.10756969, 104.3280126, "สถานีขนส่งผู้โดยสารศรีสะเกษ (ทม.ศรีสะเกษ)");
        addFixedMarker(14.64581662, 104.637256, "สถานีขนส่งผู้โดยสารศรีสะเกษ (กันทรลักษ์-อบจ.ศรีสะเกษ)");
        addFixedMarker(15.10737002, 104.3278894, "สถานีขนส่งผู้โดยสารศรีสะเกษ (เมืองใหม่ช่องสะงำ)");
        addFixedMarker(17.1591671, 104.143416, "สถานีขนส่งผู้โดยสารสกลนคร (แห่งที่ 1)");
        addFixedMarker(17.18009636, 104.1102709, "สถานีขนส่งผู้โดยสารสกลนคร (แห่งที่ 2)");
        addFixedMarker(7.18555938, 100.5934716, "สถานีขนส่งผู้โดยสารสงขลา (ประมงใหม่)");
        addFixedMarker(7.185372361, 100.5936431, "สถานีขนส่งผู้โดยสารสงขลา (แห่งที่ 1)(คลองเรียน)");
        addFixedMarker(6.998912919, 100.4454625, "สถานีขนส่งผู้โดยสารสงขลา (แห่งที่ 2)(ตลาดเกษตร)");
        addFixedMarker(6.597014624, 100.0661248, "สถานีขนส่งผู้โดยสารสตูล");
        addFixedMarker(13.82594465, 102.0672118, "สถานีขนส่งผู้โดยสารสระแก้ว");
        addFixedMarker(14.52349113, 100.9189296, "สถานีขนส่งผู้โดยสารสระบุรี (ทม.สระบุรี)");
        addFixedMarker(14.89297273, 100.3987517, "สถานีขนส่งผู้โดยสารสิงห์บุรี");
        addFixedMarker(17.01471469, 99.81257133, "สถานีขนส่งผู้โดยสารสุโขทัย (เฉลิมพระเกียรติฯ-อบจ.สุโขทัย)");
        addFixedMarker(14.47592493, 100.1247301, "สถานีขนส่งผู้โดยสารสุพรรณบุรี (บขส.)");
        addFixedMarker(14.84097201, 99.68872871, "สถานีขนส่งผู้โดยสารสุพรรณบุรี (ด่านช้าง-อบจ.สุพรรณบุรี)");
        addFixedMarker(9.111615587, 99.29830504, "สถานีขนส่งผู้โดยสารสุราษฎร์ธานี (บขส.)");
        addFixedMarker(9.521318514, 99.94133346, "สถานีขนส่งผู้โดยสารสุราษฎร์ธานี (เกาะสมุย)");
        addFixedMarker(14.8892056, 103.4964877, "สถานีขนส่งผู้โดยสารสุรินทร์");
        addFixedMarker(14.63674499, 103.4076764, "สถานีขนส่งผู้โดยสารสุรินทร์ (ปราสาท-อบจ.สุรินทร์)");
        addFixedMarker(14.63405878, 103.8596352, "สถานีขนส่งผู้โดยสารสุรินทร์ (สังขะ)");
        addFixedMarker(17.88477962, 102.7549346, "สถานีขนส่งผู้โดยสารหนองคาย (ทม.หนองคาย)");
        addFixedMarker(17.18861563, 102.4378036, "สถานีขนส่งผู้โดยสารหนองบัวลำภู (ทม.หนองบัวลำภู)");
        addFixedMarker(15.67712718, 104.8512928, "สถานีขนส่งผู้โดยสารอำนาจเจริญ");
        addFixedMarker(17.13462928, 102.9441463, "สถานีขนส่งผู้โดยสารอุดรธานี (ต.พันดอน-อบจ.อุดรธานี)");
        addFixedMarker(17.40311636, 102.8003698, "สถานีขนส่งผู้โดยสารอุดรธานี (แห่งที่ 1) (เทศบาลอุดรธานี)");
        addFixedMarker(17.41454799, 102.7643143, "สถานีขนส่งผู้โดยสารอุดรธานี (แห่งที่ 2) (เอกชน)");
        addFixedMarker(17.60979595, 100.0877598, "สถานีขนส่งผู้โดยสารอุตรดิตถ์");
        addFixedMarker(15.38832091, 100.0230989, "สถานีขนส่งผู้โดยสารอุทัยธานี (ทม.อุทัยธานี)");
        addFixedMarker(15.27269729, 104.8372973, "สถานีขนส่งผู้โดยสารอุบลราชธานี (เฉลิมพระเกียรติฯ-อบจ.อุบลราชธานี)");
        addFixedMarker(14.92160442, 105.0598194, "สถานีขนส่งผู้โดยสารอุบลราชธานี (เดชอุดม)");
        addFixedMarker(15.13338606, 105.4616578, "สถานีขนส่งผู้โดยสารอุบลราชธานี (สิรินธร)");
        addFixedMarker(13.81339147, 100.5486418, "สถานีขนส่งผู้โดยสารกรุงเทพฯ (จตุจักร)");
        addFixedMarker(13.78052495, 100.4230569, "สถานีขนส่งผู้โดยสารกรุงเทพฯ (ถนนบรมราชชนนี)");
        addFixedMarker(13.78669538, 100.4680704, "สถานีขนส่งผู้โดยสารกรุงเทพฯ (สายใต้ปิ่นเกล้า)");
        addFixedMarker(13.71979969, 100.5838918, "สถานีขนส่งผู้โดยสารกรุงเทพฯ (เอกมัย)");
        addFixedMarker(16.42975617, 102.1311635, "สถานีขนส่งผู้โดยสารอำเภอภูเขียว จังหวัดชัยภูมิ");
        addFixedMarker(20.22684683, 100.4033513, "สถานีขนส่งผู้โดยสารอำเภอเชียงราย (เชียงของ)");
        addFixedMarker(16.75245565, 101.2077681, "สถานีขนส่งผู้โดยสารอำเภอหล่มสัก จังหวัดเพชรบูรณ์");
        addFixedMarker(9.112397315, 99.29826148, "สถานีขนส่งผู้โดยสารจังหวัดสุราษฎร์ธานี");
        addFixedMarker(14.49876822, 100.1279826, "สถานีขนส่งผู้โดยสารจังหวัดสุพรรณบุรี");
        
        // ฟังก์ชันหาตำแหน่งผู้ใช้
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async function (position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;

                        // ลบ Marker เดิมถ้ามี
                        if (userMarker) map.removeLayer(userMarker);

                        // ดึงชื่อสถานที่จาก Reverse Geocoding
                        const placeName = await getPlaceName(userLat, userLng);

                        // อัพเดตตำแหน่งในแผนที่
                        map.setView([userLat, userLng], 15);
                        userMarker = L.marker([userLat, userLng]).addTo(map)
                            .bindPopup(`ตำแหน่งของคุณ: ${placeName}`)
                            .openPopup();
                    },
                    function (error) {
                        alert("ไม่สามารถหาตำแหน่งของคุณได้: " + error.message);
                    },
                    {
                        enableHighAccuracy: true, // ขอข้อมูลตำแหน่งที่มีความแม่นยำสูง
                        timeout: 25000,          // รอข้อมูลไม่เกิน 10 วินาที
                        maximumAge: 0            // ไม่ใช้ข้อมูลตำแหน่งเก่า
                    }
                );
            } else {
                alert("เบราว์เซอร์ของคุณไม่รองรับ Geolocation API");
            }
        }

        // ฟังก์ชันให้ผู้ใช้เลือกตำแหน่งเอง
        function setCustomLocation() {
            map.once('click', async function (e) {
                const customLat = e.latlng.lat;
                const customLng = e.latlng.lng;

                // ลบ Marker เดิมถ้ามี
                if (userMarker) map.removeLayer(userMarker);

                // ดึงชื่อสถานที่จาก Reverse Geocoding
                const placeName = await getPlaceName(customLat, customLng);

                // เพิ่ม Marker ใหม่
                userMarker = L.marker([customLat, customLng]).addTo(map)
                    .bindPopup(`คุณเลือกตำแหน่ง: ${placeName}`)
                    .openPopup();
            });
            alert("คลิกบนแผนที่เพื่อเลือกตำแหน่งของคุณ");
        }
    </script>
</body>
</html>
